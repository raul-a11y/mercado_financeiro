<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Plataforma Financeira - Kanban</title>
<style>
  /* Reset b√°sico e corpo */
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    display: flex;
    height: 100vh;
    background: #f5f5f5;
  }

  /* Sidebar lateral */
  #sidebar {
    width: 220px;
    background-color: #2c3e50;
    color: white;
    display: flex;
    flex-direction: column;
    padding: 1rem;
  }

  #sidebar h2 {
    margin-top: 0;
    font-size: 1.5rem;
    margin-bottom: 1rem;
  }

  #sidebar nav a {
    color: white;
    text-decoration: none;
    padding: 0.7rem 1rem;
    margin-bottom: 0.5rem;
    border-radius: 4px;
    display: block;
    transition: background-color 0.3s ease;
    cursor: pointer;
  }

  #sidebar nav a:hover,
  #sidebar nav a.active {
    background-color: #34495e;
  }

  /* Conte√∫do principal */
  main {
    flex: 1;
    padding: 1rem;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }

  /* Filtros */
  #filters {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  #filters input[type="text"],
  #filters select {
    padding: 0.5rem;
    font-size: 1rem;
    flex: 1;
    border: 1px solid #ccc;
    border-radius: 4px;
  }

  /* Container das colunas do kanban */
  #columns-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 16px;  /* Espa√ßamento entre colunas e linhas */
    padding: 1rem 0;
    overflow-x: auto;
  }

  /* Cada coluna */
  .column {
    background: white;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
    display: flex;
    flex-direction: column;
    max-height: 80vh;
  }

  /* Header da coluna com input para editar nome */
  .column-header {
    background-color: #2980b9;
    padding: 0.5rem;
    color: white;
    font-weight: bold;
    border-top-left-radius: 6px;
    border-top-right-radius: 6px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .column-header input[type="text"] {
    flex: 1;
    font-weight: bold;
    font-size: 1.1rem;
    border: none;
    background: transparent;
    color: white;
    cursor: text;
  }

  .column-header input[type="text"]:focus {
    outline: 2px solid #fff;
    background: rgba(255,255,255,0.2);
    border-radius: 4px;
  }

  .remove-column-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0 0.3rem;
    transition: color 0.3s ease;
  }

  .remove-column-btn:hover {
    color: #e74c3c;
  }

  /* Lista de tarefas */
  .task-list {
    list-style: none;
    margin: 0;
    padding: 0.5rem;
    flex: 1;
    overflow-y: auto;
  }

  /* Item da tarefa */
  .task-list li {
    background: #ecf0f1;
    margin-bottom: 0.5rem;
    padding: 0.5rem 0.75rem;
    border-radius: 4px;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 1px 2px rgb(0 0 0 / 0.1);
  }

  .task-list li.high-priority {
    border-left: 5px solid #e74c3c; /* vermelho */
  }

  .task-list li.medium-priority {
    border-left: 5px solid #f39c12; /* amarelo */
  }

  .task-list li.low-priority {
    border-left: 5px solid #27ae60; /* verde */
  }

  .task-list li.dragging {
    opacity: 0.5;
  }

  /* Bot√£o adicionar tarefa */
  .column > button {
    background-color: #27ae60;
    border: none;
    color: white;
    padding: 0.5rem;
    font-weight: bold;
    cursor: pointer;
    border-radius: 0 0 6px 6px;
    transition: background-color 0.3s ease;
  }

  .column > button:hover {
    background-color: #219150;
  }

  /* M√©tricas */
  #metrics {
    margin-top: 1rem;
    font-size: 1.1rem;
    color: #333;
  }

  /* Modal */
  #modal-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.4);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }

  #modal {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    width: 320px;
    max-width: 90%;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  #modal label {
    font-weight: bold;
  }

  #modal input[type="text"],
  #modal textarea,
  #modal select {
    width: 100%;
    padding: 0.4rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 1rem;
    box-sizing: border-box;
  }

  #modal-buttons {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
  }

  #modal-buttons button {
    padding: 0.5rem 1rem;
    font-weight: bold;
    cursor: pointer;
    border: none;
    border-radius: 4px;
  }

  #modal-cancel {
    background: #e74c3c;
    color: white;
  }

  #modal-save {
    background: #27ae60;
    color: white;
  }

  /* Bot√£o para adicionar coluna (etapa) */
  #add-column-btn {
    margin-top: 1rem;
    padding: 0.5rem 1rem;
    font-weight: bold;
    background-color: #2980b9;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    align-self: start;
    transition: background-color 0.3s ease;
  }

  #add-column-btn:hover {
    background-color: #1f5f8b;
  }
</style>
</head>
<body>

<div id="sidebar">
  <h2>Menu</h2>
  <nav>
    <a href="#" class="active" data-module="kanban">üìã Kanban</a>
    <a href="#" data-module="analytics">üìà Analytics</a>
    <a href="#" data-module="settings">‚öôÔ∏è Configura√ß√µes</a>
  </nav>
</div>

<main>
  <section id="filters">
    <input type="text" id="filter-title" placeholder="Filtrar por t√≠tulo..." />
    <select id="filter-priority">
      <option value="">Todas prioridades</option>
      <option value="high">Alta</option>
      <option value="medium">M√©dia</option>
      <option value="low">Baixa</option>
    </select>
    <input type="text" id="filter-responsible" placeholder="Filtrar por respons√°vel..." />
  </section>

  <section id="columns-container"></section>

  <button id="add-column-btn">+ Adicionar etapa</button>

  <div id="metrics"></div>
</main>

<!-- Modal para editar/adicionar tarefa -->
<div id="modal-bg">
  <div id="modal">
    <label for="task-title">T√≠tulo:</label>
    <input type="text" id="task-title" />

    <label for="task-description">Descri√ß√£o:</label>
    <textarea id="task-description" rows="3"></textarea>

    <label for="task-priority">Prioridade:</label>
    <select id="task-priority">
      <option value="high">Alta</option>
      <option value="medium">M√©dia</option>
      <option value="low">Baixa</option>
    </select>

    <label for="task-responsible">Respons√°vel:</label>
    <input type="text" id="task-responsible" />

    <div id="modal-buttons">
      <button id="modal-cancel">Cancelar</button>
      <button id="modal-save">Salvar</button>
    </div>
  </div>
</div>

<script>
  // Dados iniciais
  let columns = [
    { id: 'todo', name: 'A Fazer' },
    { id: 'inprogress', name: 'Em Progresso' },
    { id: 'done', name: 'Conclu√≠do' },
  ];

  let tasks = [
    { id: 't1', title: 'Comprar a√ß√µes da Apple', description: 'Pesquisar pre√ßo e comprar.', priority: 'high', responsible: 'Carlos', status: 'todo' },
    { id: 't2', title: 'Analisar relat√≥rio trimestral', description: 'Revisar os dados financeiros.', priority: 'medium', responsible: 'Ana', status: 'inprogress' },
    { id: 't3', title: 'Reuni√£o com investidores', description: 'Preparar apresenta√ß√£o.', priority: 'low', responsible: 'Jo√£o', status: 'done' },
  ];

  // Salvar e carregar do localStorage
  function saveColumns() {
    localStorage.setItem('kanban-columns', JSON.stringify(columns));
  }

  function saveTasks() {
    localStorage.setItem('kanban-tasks', JSON.stringify(tasks));
  }

  function loadData() {
    const savedColumns = localStorage.getItem('kanban-columns');
    const savedTasks = localStorage.getItem('kanban-tasks');
    if (savedColumns) columns = JSON.parse(savedColumns);
    if (savedTasks) tasks = JSON.parse(savedTasks);
  }

  loadData();

  // Renderiza colunas e tarefas
  function renderColumns() {
    const container = document.getElementById('columns-container');
    container.innerHTML = '';

    columns.forEach(col => {
      const colDiv = document.createElement('div');
      colDiv.className = 'column';
      colDiv.dataset.id = col.id;

      // Header com input para editar nome e bot√£o remover
      const header = document.createElement('div');
      header.className = 'column-header';

      const input = document.createElement('input');
      input.type = 'text';
      input.value = col.name;
      input.title = 'Clique para editar nome da etapa';
      input.addEventListener('change', e => {
        col.name = e.target.value.trim() || col.name;
        saveColumns();
        renderMetrics();
      });

      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-column-btn';
      removeBtn.textContent = '√ó';
      removeBtn.title = 'Remover etapa';
      removeBtn.addEventListener('click', () => {
        if (confirm(`Remover etapa "${col.name}"? As tarefas ser√£o movidas para a primeira etapa.`)) {
          // Move tasks para primeira coluna
          const firstColId = columns[0].id;
          tasks.forEach(t => {
            if (t.status === col.id) t.status = firstColId;
          });
          columns = columns.filter(c => c.id !== col.id);
          saveColumns();
          saveTasks();
          renderColumns();
          renderMetrics();
        }
      });

      header.appendChild(input);
      if(columns.length > 1) header.appendChild(removeBtn);

      colDiv.appendChild(header);

      // Lista tarefas filtradas para essa coluna
      const ul = document.createElement('ul');
      ul.className = 'task-list';
      ul.dataset.status = col.id;

      const filteredTasks = tasks.filter(t => {
        if(t.status !== col.id) return false;

        const titleFilter = document.getElementById('filter-title').value.toLowerCase();
        const priorityFilter = document.getElementById('filter-priority').value;
        const respFilter = document.getElementById('filter-responsible').value.toLowerCase();

        if(titleFilter && !t.title.toLowerCase().includes(titleFilter)) return false;
        if(priorityFilter && t.priority !== priorityFilter) return false;
        if(respFilter && !t.responsible.toLowerCase().includes(respFilter)) return false;

        return true;
      });

      filteredTasks.forEach(task => {
        const li = document.createElement('li');
        li.textContent = task.title;
        li.className = task.priority + '-priority';
        li.draggable = true;
        li.dataset.id = task.id;

        // Drag events
        li.addEventListener('dragstart', e => {
          e.dataTransfer.setData('text/plain', task.id);
          li.classList.add('dragging');
        });
        li.addEventListener('dragend', e => {
          li.classList.remove('dragging');
        });

        // Click para editar tarefa
        li.addEventListener('click', () => openTaskModal(task));

        ul.appendChild(li);
      });

      // Permitir drop na coluna
      ul.addEventListener('dragover', e => e.preventDefault());
      ul.addEventListener('drop', e => {
        e.preventDefault();
        const taskId = e.dataTransfer.getData('text/plain');
        const task = tasks.find(t => t.id === taskId);
        if (task && task.status !== col.id) {
          task.status = col.id;
          saveTasks();
          renderColumns();
          renderMetrics();
        }
      });

      colDiv.appendChild(ul);

      // Bot√£o adicionar tarefa
      const addTaskBtn = document.createElement('button');
      addTaskBtn.textContent = '+ Adicionar Tarefa';
      addTaskBtn.addEventListener('click', () => openTaskModal(null, col.id));
      colDiv.appendChild(addTaskBtn);

      container.appendChild(colDiv);
    });

    renderMetrics();
  }

  // Modal controle
  const modalBg = document.getElementById('modal-bg');
  const taskTitleInput = document.getElementById('task-title');
  const taskDescInput = document.getElementById('task-description');
  const taskPrioritySelect = document.getElementById('task-priority');
  const taskResponsibleInput = document.getElementById('task-responsible');
  let editingTask = null; // null = new task
  let editingStatus = null;

  function openTaskModal(task, status) {
    editingTask = task;
    editingStatus = status || (task ? task.status : columns[0].id);
    taskTitleInput.value = task ? task.title : '';
    taskDescInput.value = task ? task.description : '';
    taskPrioritySelect.value = task ? task.priority : 'medium';
    taskResponsibleInput.value = task ? task.responsible : '';
    modalBg.style.display = 'flex';
    taskTitleInput.focus();
  }

  document.getElementById('modal-cancel').addEventListener('click', () => {
    modalBg.style.display = 'none';
  });

  document.getElementById('modal-save').addEventListener('click', () => {
    const title = taskTitleInput.value.trim();
    if(!title) {
      alert('O t√≠tulo √© obrigat√≥rio.');
      taskTitleInput.focus();
      return;
    }

    if(editingTask) {
      // Edita tarefa existente
      editingTask.title = title;
      editingTask.description = taskDescInput.value.trim();
      editingTask.priority = taskPrioritySelect.value;
      editingTask.responsible = taskResponsibleInput.value.trim();
    } else {
      // Nova tarefa
      tasks.push({
        id: 't' + Date.now(),
        title,
        description: taskDescInput.value.trim(),
        priority: taskPrioritySelect.value,
        responsible: taskResponsibleInput.value.trim(),
        status: editingStatus
      });
    }
    saveTasks();
    renderColumns();
    modalBg.style.display = 'none';
  });

  // Filtros
  document.getElementById('filter-title').addEventListener('input', renderColumns);
  document.getElementById('filter-priority').addEventListener('change', renderColumns);
  document.getElementById('filter-responsible').addEventListener('input', renderColumns);

  // M√©tricas com √≠cones
  function renderMetrics() {
    const total = tasks.length;
    const byStatus = {};
    columns.forEach(c => byStatus[c.id] = 0);
    tasks.forEach(t => {
      if(byStatus[t.status] !== undefined) byStatus[t.status]++;
    });

    // √çcones Unicode simples
    const iconDone = '‚úîÔ∏è';
    const iconInProgress = '‚è≥';
    const iconTodo = 'üìù';

    let metricsHtml = `<strong>M√©tricas:</strong> Total: ${total} | `;
    columns.forEach(c => {
      let icon = 'üìå';
      if(c.id === 'done') icon = iconDone;
      else if(c.id === 'inprogress') icon = iconInProgress;
      else if(c.id === 'todo') icon = iconTodo;

      metricsHtml += `${icon} ${c.name}: ${byStatus[c.id]} | `;
    });

    document.getElementById('metrics').innerHTML = metricsHtml.slice(0, -3);
  }

  // Adicionar coluna nova
  document.getElementById('add-column-btn').addEventListener('click', () => {
    let newName = prompt('Nome da nova etapa:');
    if(newName) {
      newName = newName.trim();
      if(!newName) return alert('Nome inv√°lido.');
      // Gerar ID simples √∫nico
      const newId = newName.toLowerCase().replace(/\s+/g, '-') + '-' + Date.now();
      columns.push({id: newId, name: newName});
      saveColumns();
      renderColumns();
    }
  });

  // Inicializa
  renderColumns();
</script>

</body>
</html>
