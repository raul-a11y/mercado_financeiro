<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kanban Din√¢mico com Sidebar - Mercado Financeiro</title>
  <style>
    /* Reset e b√°sico */
    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      display: flex;
      min-height: 100vh;
      overflow: hidden;
    }

    /* Sidebar lateral fixa */
    #sidebar {
      width: 220px;
      background: #1e293b;
      color: white;
      display: flex;
      flex-direction: column;
      padding: 1rem;
      box-sizing: border-box;
      user-select: none;
    }
    #sidebar h2 {
      margin: 0 0 1rem 0;
      font-weight: 700;
      font-size: 1.3rem;
      text-align: center;
    }
    #sidebar nav a {
      color: #cbd5e1;
      text-decoration: none;
      padding: 0.6rem 1rem;
      border-radius: 4px;
      margin-bottom: 0.5rem;
      display: block;
      transition: background-color 0.3s;
    }
    #sidebar nav a:hover, #sidebar nav a.active {
      background-color: #3b82f6;
      color: white;
    }
    #sidebar nav a:focus {
      outline: 2px solid #3b82f6;
      outline-offset: 2px;
    }

    /* Container principal (kanban + filtros) */
    #main-content {
      flex-grow: 1;
      padding: 1rem 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      box-sizing: border-box;
    }

    /* Bot√£o adicionar coluna */
    #add-column-btn {
      background-color: #22c55e;
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      font-weight: bold;
      width: max-content;
      cursor: pointer;
      align-self: flex-start;
    }

    /* Filtros */
    #filters {
      display: flex;
      gap: 0.7rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    #filters input, #filters select {
      padding: 0.4rem 0.6rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      min-width: 140px;
    }

    /* Container e grid kanban */
    #columns-container {
      display: grid;
      gap: 1rem;
      grid-auto-flow: column;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }

    /* Coluna */
    .column {
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      padding: 1rem;
      min-width: 280px;
      max-height: 75vh;
    }

    /* Cabe√ßalho edit√°vel */
    .column-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .column-header input[type="text"] {
      font-weight: 600;
      font-size: 1.1rem;
      border: none;
      border-bottom: 2px solid transparent;
      outline: none;
      width: 100%;
      background: transparent;
      transition: border-color 0.3s;
    }
    .column-header input[type="text"]:focus {
      border-color: #3b82f6;
    }
    .remove-column-btn {
      background: transparent;
      border: none;
      color: #ef4444;
      font-weight: bold;
      font-size: 1.3rem;
      cursor: pointer;
      padding: 0 5px;
      user-select: none;
    }

    /* Lista tarefas */
    ul.task-list {
      flex-grow: 1;
      overflow-y: auto;
      min-height: 150px;
      padding-left: 0;
      margin: 0;
      list-style: none;
    }
    ul.task-list li {
      background: #e5e7eb;
      padding: 0.6rem 1rem;
      margin: 0.5rem 0;
      border-radius: 4px;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    ul.task-list li.dragging {
      opacity: 0.6;
    }

    /* Bot√£o adicionar tarefa */
    .column > button {
      margin-top: 0.5rem;
      background-color: #2563eb;
      border: none;
      color: white;
      padding: 0.5rem;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }
    .column > button:hover {
      background-color: #1d4ed8;
    }

    /* Modal */
    #modal-bg {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 20;
    }
    #modal {
      background: white;
      padding: 1.5rem;
      border-radius: 8px;
      width: 320px;
      max-width: 90vw;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    #modal label {
      font-weight: bold;
      font-size: 0.9rem;
    }
    #modal input, #modal select, #modal textarea {
      width: 100%;
      padding: 0.4rem 0.6rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 0.9rem;
      box-sizing: border-box;
    }
    #modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }
    #modal-buttons button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }
    #modal-save {
      background-color: #3b82f6;
      color: white;
    }
    #modal-cancel {
      background-color: #ef4444;
      color: white;
    }

    /* M√©tricas */
    #metrics {
      font-size: 0.9rem;
      font-weight: bold;
      margin-top: 1rem;
      color: #334155;
    }

    /* Scrollbar para colunas */
    #columns-container::-webkit-scrollbar {
      height: 8px;
    }
    #columns-container::-webkit-scrollbar-thumb {
      background: #94a3b8;
      border-radius: 4px;
    }
    #columns-container::-webkit-scrollbar-track {
      background: #e2e8f0;
    }

    /* Responsividade */
    @media (max-width: 768px) {
      #sidebar {
        width: 60px;
        padding: 0.5rem;
      }
      #sidebar h2 {
        font-size: 0;
      }
      #sidebar nav a {
        text-align: center;
        padding: 0.6rem 0;
        font-size: 1.3rem;
      }
      #main-content {
        padding: 1rem 0.8rem;
      }
    }

  </style>
</head>
<body>

  <aside id="sidebar" role="navigation" aria-label="Menu lateral">
    <h2>Finance</h2>
    <nav>
      <a href="#" class="active" data-module="kanban" tabindex="0">üìã Kanban</a>
      <a href="#" data-module="reports" tabindex="0">üìä Relat√≥rios</a>
      <a href="#" data-module="portfolio" tabindex="0">üíº Portf√≥lio</a>
      <a href="#" data-module="settings" tabindex="0">‚öôÔ∏è Configura√ß√µes</a>
    </nav>
  </aside>

  <main id="main-content" role="main" tabindex="-1">
    <button id="add-column-btn" aria-label="Adicionar nova etapa no kanban">+ Nova Etapa</button>

    <div id="filters" role="search" aria-label="Filtros para tarefas">
      <input type="text" id="filter-title" placeholder="Filtrar por t√≠tulo" aria-label="Filtro por t√≠tulo" />
      <select id="filter-priority" aria-label="Filtro por prioridade">
        <option value="">Todas prioridades</option>
        <option value="Alta">Alta</option>
        <option value="M√©dia">M√©dia</option>
        <option value="Baixa">Baixa</option>
      </select>
      <input type="text" id="filter-responsible" placeholder="Filtrar por respons√°vel" aria-label="Filtro por respons√°vel" />
    </div>

    <div id="columns-container" aria-live="polite" aria-relevant="additions removals"></div>

    <div id="metrics" aria-live="polite" aria-atomic="true"></div>

    <!-- Modal de edi√ß√£o/cria√ß√£o -->
    <div id="modal-bg" role="dialog" aria-modal="true" aria-labelledby="modal-label" tabindex="-1">
      <form id="modal" onsubmit="return false;">
        <h3 id="modal-label">Editar Tarefa</h3>
        <label for="modal-title">T√≠tulo *</label>
        <input type="text" id="modal-title" required autocomplete="off" />
        <label for="modal-desc">Descri√ß√£o</label>
        <textarea id="modal-desc" rows="3"></textarea>
        <label for="modal-priority">Prioridade</label>
        <select id="modal-priority">
          <option value="Alta">Alta</option>
          <option value="M√©dia" selected>M√©dia</option>
          <option value="Baixa">Baixa</option>
        </select>
        <label for="modal-responsible">Respons√°vel</label>
        <input type="text" id="modal-responsible" autocomplete="off" />
        <div id="modal-buttons">
          <button type="button" id="modal-cancel">Cancelar</button>
          <button type="submit" id="modal-save">Salvar</button>
        </div>
      </form>
    </div>

  </main>

<script>
  // Dados e persist√™ncia
  const columnsKey = 'kanban-columns';
  const tasksKey = 'kanban-tasks';

  let columns = JSON.parse(localStorage.getItem(columnsKey)) || [
    { id: 'col-1', name: 'A Fazer' },
    { id: 'col-2', name: 'Em Progresso' },
    { id: 'col-3', name: 'Conclu√≠do' }
  ];

  let tasks = JSON.parse(localStorage.getItem(tasksKey)) || [];

  function saveColumns() {
    localStorage.setItem(columnsKey, JSON.stringify(columns));
  }
  function saveTasks() {
    localStorage.setItem(tasksKey, JSON.stringify(tasks));
  }

  // Renderiza as colunas e tarefas
  function renderColumns() {
    const container = document.getElementById('columns-container');
    container.innerHTML = '';

    const titleFilter = document.getElementById('filter-title').value.toLowerCase();
    const priorityFilter = document.getElementById('filter-priority').value;
    const responsibleFilter = document.getElementById('filter-responsible').value.toLowerCase();

    columns.forEach((col, idx) => {
      const colDiv = document.createElement('div');
      colDiv.className = 'column';

      const headerDiv = document.createElement('div');
      headerDiv.className = 'column-header';

      const inputTitle = document.createElement('input');
      inputTitle.type = 'text';
      inputTitle.value = col.name;
      inputTitle.title = "Clique e altere o nome da etapa";
      inputTitle.addEventListener('change', e => {
        const val = e.target.value.trim();
        if (val) {
          columns[idx].name = val;
          saveColumns();
          renderColumns();
        } else {
          e.target.value = columns[idx].name;
        }
      });
      headerDiv.appendChild(inputTitle);

      if (columns.length > 1) {
        const delBtn = document.createElement('button');
        delBtn.className = 'remove-column-btn';
        delBtn.textContent = '‚úï';
        delBtn.title = 'Remover etapa (as tarefas ser√£o movidas para a primeira etapa)';
        delBtn.onclick = () => {
          tasks.forEach(task => {
            if (task.status === col.id) {
              task.status = columns[0].id;
            }
          });
          columns.splice(idx, 1);
          saveColumns();
          saveTasks();
          renderColumns();
        };
        headerDiv.appendChild(delBtn);
      }

      colDiv.appendChild(headerDiv);

      const ul = document.createElement('ul');
      ul.className = 'task-list';
      ul.id = col.id;
      ul.addEventListener('dragover', allowDrop);
      ul.addEventListener('drop', drop);

      tasks.filter(t => 
        t.status === col.id &&
        t.title.toLowerCase().includes(titleFilter) &&
        (priorityFilter === '' || t.priority === priorityFilter) &&
        t.responsible.toLowerCase().includes(responsibleFilter)
      ).forEach(task => {
        const li = document.createElement('li');
        li.textContent = task.title;
        li.draggable = true;
        li.dataset.id = task.id;
        li.title = `Prioridade: ${task.priority}\nRespons√°vel: ${task.responsible}`;
        li.classList.toggle('high-priority', task.priority === 'Alta');
        li.classList.toggle('medium-priority', task.priority === 'M√©dia');
        li.classList.toggle('low-priority', task.priority === 'Baixa');
        li.addEventListener('dragstart', dragStart);
        li.addEventListener('click', () => openModal(task.id));

        ul.appendChild(li);
      });

      colDiv.appendChild(ul);

      const addTaskBtn = document.createElement('button');
      addTaskBtn.textContent = '+ Adicionar Tarefa';
      addTaskBtn.style.marginTop = '0.5rem';
      addTaskBtn.onclick = () => openModal(null, col.id);

      colDiv.appendChild(addTaskBtn);

      container.appendChild(colDiv);
    });

    document.getElementById('columns-container').style.gridTemplateColumns = 
      `repeat(auto-fit, minmax(250px, 1fr))`;

    updateMetrics();
  }

  // Modal de tarefa
  let editingTaskId = null;

  function openModal(taskId, forcedStatus) {
    editingTaskId = taskId;
    const modalBg = document.getElementById('modal-bg');
    modalBg.style.display = 'flex';

    const task = tasks.find(t => t.id === taskId);

    document.getElementById('modal-title').value = task ? task.title : '';
    document.getElementById('modal-desc').value = task ? task.description : '';
    document.getElementById('modal-priority').value = task ? task.priority : 'M√©dia';
    document.getElementById('modal-responsible').value = task ? task.responsible : '';
    modalBg.dataset.forcedStatus = forcedStatus || '';

    // Foco inicial no input t√≠tulo
    setTimeout(() => {
      document.getElementById('modal-title').focus();
    }, 100);
  }

  document.getElementById('modal-cancel').onclick = () => {
    document.getElementById('modal-bg').style.display = 'none';
  };

  document.getElementById('modal-save').onclick = () => {
    const title = document.getElementById('modal-title').value.trim();
    if (!title) {
      alert('T√≠tulo √© obrigat√≥rio!');
      return;
    }
    const desc = document.getElementById('modal-desc').value.trim();
    const priority = document.getElementById('modal-priority').value;
    const responsible = document.getElementById('modal-responsible').value.trim();

    if (editingTaskId) {
      // Edita existente
      const task = tasks.find(t => t.id === editingTaskId);
      if (task) {
        task.title = title;
        task.description = desc;
        task.priority = priority;
        task.responsible = responsible;
      }
    } else {
      // Cria novo
      const newTask = {
        id: 'task-' + Date.now(),
        title,
        description: desc,
        priority,
        responsible,
        status: document.getElementById('modal-bg').dataset.forcedStatus || columns[0].id
      };
      tasks.push(newTask);
    }

    document.getElementById('modal-bg').style.display = 'none';
    saveTasks();
    renderColumns();
  };

  // Drag & Drop handlers
  let draggedTaskId = null;

  function dragStart(e) {
    draggedTaskId = e.target.dataset.id;
    e.dataTransfer.effectAllowed = 'move';
    e.target.classList.add('dragging');
  }
  function allowDrop(e) {
    e.preventDefault();
  }
  function drop(e) {
    e.preventDefault();
    const newStatus = e.currentTarget.id;
    if (!draggedTaskId) return;

    const task = tasks.find(t => t.id === draggedTaskId);
    if (task && task.status !== newStatus) {
      task.status = newStatus;
      saveTasks();
      renderColumns();
    }
    draggedTaskId = null;
  }

  // Filtros
  const filterTitle = document.getElementById('filter-title');
  const filterPriority = document.getElementById('filter-priority');
  const filterResponsible = document.getElementById('filter-responsible');

  filterTitle.addEventListener('input', renderColumns);
  filterPriority.addEventListener('change', renderColumns);
  filterResponsible.addEventListener('input', renderColumns);

  // M√©tricas com √≠cones
  function updateMetrics() {
    const total = tasks.length;
    const byStatus = {};
    columns.forEach(col => byStatus[col.id] = 0);
    tasks.forEach(t => {
      if (byStatus[t.status] !== undefined) byStatus[t.status]++;
    });

    const statusIcons = {};
    if(columns[0]) statusIcons[columns[0].id] = 'üìå';
    if(columns[1]) statusIcons[columns[1].id] = '‚è≥';
    if(columns[2]) statusIcons[columns[2].id] = '‚úÖ';

    const metricsDiv = document.getElementById('metrics');
    metricsDiv.innerHTML = `<p>üìã Total de tarefas: ${total}</p>` +
      columns.map(col => 
        `<p>${statusIcons[col.id] || '‚û°Ô∏è'} ${col.name}: ${byStatus[col.id]}</p>`
      ).join('');
  }

  // Adicionar nova coluna
  document.getElementById('add-column-btn').addEventListener('click', () => {
    const name = prompt('Digite o nome da nova etapa:');
    if (name && name.trim()) {
      columns.push({ id: 'col-' + Date.now(), name: name.trim() });
      saveColumns();
      renderColumns();
    }
  });

  // Sidebar navega√ß√£o (exemplo simples)
  document.querySelectorAll('#sidebar nav a').forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      document.querySelectorAll('#sidebar nav a').forEach(a => a.classList.remove('active'));
      e.target.classList.add('active');

      // Aqui voc√™ pode trocar o conte√∫do conforme m√≥dulo:
      if(e.target.dataset.module === 'kanban') {
        document.getElementById('main-content').style.display = 'flex';
      } else {
        document.getElementById('main-content').style.display = 'none';
        alert(`M√≥dulo "${e.target.textContent.trim()}" em desenvolvimento.`);
      }
    });
  });

  // Inicializa
  renderColumns();

</script>
</body>
</html>
